<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <title>AquaPi | Total Water Usage</title>
    <meta name="description" content="test">
    <link rel="icon" href="images/logo-round.png">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="jquery.csv.min.js"></script>
    <script src="chart.bundle.min.js"></script>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>

    <!-- <script type="text/javascript">
        // load the visualisation API
        google.load('visualization', '1', { packages: ['corechart', 'controls'] });
    </script> -->

    <script type="text/javascript">
    // allows watching globally via Chrome DevTools
    var labelNames = new Array();
    var dataValues = new Array();

        function drawVisualization() {
            $.get("totals/daily.csv", function(csvString) {
                // Split CSV string into labels and data values
                var i = 0;
                var lines = csvString.split("\n")
                lines.forEach(function(line) {
                    if (i != 0 && i != (lines.length - 1)) {
                        var items = line.split(",");
                        labelNames.push(items[0]);
                        dataValues.push(Number(items[1]));
                    }
                    i ++
                });
                alert(labelNames);
                alert(dataValues);

                // Specify chart data
                data = {
                    datasets: [{
                        label: "Amount of water used today /L",
                        data: dataValues
                        // data: [100,36,24.803,25.483,24.729,10,0]
                    }],
                    // These labels appear in the legend and in the tooltips when hovering different arcs
                    labels: labelNames
                    // labels: ["Bath","Kitchen Sink","Dishwasher","Washing Machine","Shower","Bathroom Tap","Outdoor Hose"]
                };
                var options = {
                    title: 'Total Water Uage - Past Week',
                    color: ['#000','#777','#888','#999','#ccc','#ddd','#fff']
                };

                // Draw doughnut chart
                var ctx = document.getElementById("dailyTotalDoughnutChart");
                var dailyTotalDoughnutChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: data,
                    options: options
                });

                // // Auto-update charts
                // function updateChart(chart) {
                //     chart.update(0);
                // }
                // setTimeout(updateChart(),1000);

                // OLD (Google Graphs)
                // transform the CSV string into a 2-dimensional array
                // var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
                // this new DataTable object holds all the data
                // var data = new google.visualization.arrayToDataTable(arrayData);
                // var chart = new google.visualization.PieChart(document.getElementById('piechart'));
                // chart.draw(data, options);
            });
        }

        drawVisualization();

        // setTimeout(google.setOnLoadCallback(drawVisualization),3000);
    </script>
</head>

<div id="dailyTotalDoughnutChart"></div>
